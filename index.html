<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Advanced Search Hub</title>
  <style>
    :root {
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --bg-card: #2a2a2a;
      --text-primary: #e0e0e0;
      --text-secondary: #b0b0b0;
      --text-muted: #808080;
      --border-color: #404040;
      --accent-color: #1e88e5;
      --accent-hover: #1565c0;
      --input-bg: #333;
      --input-border: #555;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 20px;
	  font-size: 120%;
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 10px;
      color: var(--text-primary);
    }

    .tagline {
      color: var(--text-secondary);
      font-size: 0.95em;
    }

    .provider-selector {
      background: var(--bg-card);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      border: 1px solid var(--border-color);
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .provider-selector label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      font-size: 1.1em;
    }
    .provider-selector .select-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    select, input[type="text"], input[type="number"], input[type="date"], textarea {
      width: 100%;
      padding: 10px 12px;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 4px;
      color: var(--text-primary);
      font-size: 14px;
      min-height: 44px;
    }

    select:focus, input:focus, textarea:focus {
      outline: 2px solid var(--accent-color);
      outline-offset: 2px;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .search-form {
      display: none;
      background: var(--bg-card);
      padding: 30px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }

    .search-form.active {
      display: block;
    }

    .load-error {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      padding: 20px;
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.95em;
      margin-bottom: 20px;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .form-section h3 {
      color: var(--accent-color);
      margin-bottom: 15px;
      font-size: 1.2em;
      border-bottom: 2px solid var(--border-color);
      padding-bottom: 8px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      margin-bottom: 6px;
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 0.9em;
    }

    .form-group small {
      margin-top: 4px;
      color: var(--text-muted);
      font-size: 0.85em;
    }

    .inline-options {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin-top: 12px;
    }

    .inline-options label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.9em;
      color: var(--text-secondary);
    }

    .inline-options input[type="checkbox"],
    .inline-options input[type="radio"] {
      width: auto;
      min-height: auto;
      accent-color: var(--accent-color);
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 30px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      min-height: 44px;
      transition: background-color 0.2s;
    }

    button[type="submit"] {
      background: var(--accent-color);
      color: white;
    }

    button[type="submit"]:hover {
      background: var(--accent-hover);
    }

    button[type="button"] {
      background: #555;
      color: white;
    }

    button[type="button"]:hover {
      background: #666;
    }

    button:focus {
      outline: 2px solid var(--accent-color);
      outline-offset: 2px;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }

      body {
        padding: 10px;
      }

      .search-form {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="provider-selector">
      <div class="select-group">
        <label for="providerSelectGoogle">Google Searches</label>
        <select id="providerSelectGoogle" class="provider-select">
          <option value="">Choose a Google search...</option>
          <option value="google-images">Google Images</option>
          <option value="google-news">Google News</option>
          <option value="google-scholar">Google Scholar</option>
          <option value="google-web" selected>Google Web Search</option>
        </select>
      </div>
      <div class="select-group">
        <label for="providerSelectMediaWiki">MediaWiki Searches</label>
        <select id="providerSelectMediaWiki" class="provider-select">
          <option value="">Choose a MediaWiki search...</option>
          <option value="wikimedia-commons">Wikimedia Commons</option>
          <option value="wikibooks">Wikibooks</option>
          <option value="wikisource">Wikisource</option>
          <option value="wikipedia">Wikipedia</option>
        </select>
      </div>
      <div class="select-group">
        <label for="providerSelectMiscAM">Miscellaneous A-M</label>
        <select id="providerSelectMiscAM" class="provider-select">
          <option value="">Choose an A-M search...</option>
          <option value="archive">Internet Archive</option>
          <option value="github">GitHub</option>
          <option value="imdb">IMDb</option>
          <option value="mdn">MDN Web Docs</option>
        </select>
      </div>
      <div class="select-group">
        <label for="providerSelectMiscNZ">Miscellaneous N-Z</label>
        <select id="providerSelectMiscNZ" class="provider-select">
          <option value="">Choose an N-Z search...</option>
          <option value="pubmed">PubMed</option>
          <option value="pypi">PyPI</option>
          <option value="reddit">Reddit</option>
          <option value="stackoverflow">Stack Overflow</option>
          <option value="youtube">YouTube</option>
        </select>
      </div>
    </div>

    <!-- Google Web Search -->
    <div class="site-include" data-site="google-web" data-src="sites/google-web.html"></div>
    <!-- Google Images -->
    <div class="site-include" data-site="google-images" data-src="sites/google-images.html"></div>
    <!-- Google News -->
    <div class="site-include" data-site="google-news" data-src="sites/google-news.html"></div>
    <!-- Google Scholar -->
    <div class="site-include" data-site="google-scholar" data-src="sites/google-scholar.html"></div>
    <!-- GitHub -->
    <div class="site-include" data-site="github" data-src="sites/github.html"></div>
    <!-- Reddit -->
    <div class="site-include" data-site="reddit" data-src="sites/reddit.html"></div>
    <!-- YouTube -->
    <div class="site-include" data-site="youtube" data-src="sites/youtube.html"></div>
    <!-- Stack Overflow -->
    <div class="site-include" data-site="stackoverflow" data-src="sites/stackoverflow.html"></div>
    <!-- Wikipedia -->

    <div class="site-include" data-site="wikipedia" data-src="sites/wikipedia.html"></div>
    <!-- Wikimedia Commons -->
    <div class="site-include" data-site="wikimedia-commons" data-src="sites/wikimedia-commons.html"></div>

    <!-- Wikibooks -->
    <div class="site-include" data-site="wikibooks" data-src="sites/wikibooks.html"></div>

    <!-- Wikisource -->
    <div class="site-include" data-site="wikisource" data-src="sites/wikisource.html"></div>

    <!-- MDN Web Docs -->
    <div class="site-include" data-site="mdn" data-src="sites/mdn.html"></div>

    <!-- IMDb -->
    <div class="site-include" data-site="imdb" data-src="sites/imdb.html"></div>

    <!-- PyPI -->
    <div class="site-include" data-site="pypi" data-src="sites/pypi.html"></div>

    <!-- PubMed -->
    <div class="site-include" data-site="pubmed" data-src="sites/pubmed.html"></div>

    <!-- Internet Archive -->
    <div class="site-include" data-site="archive" data-src="sites/archive.html"></div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const providerSelects = Array.from(document.querySelectorAll('.provider-select'));
      const siteIncludeContainers = Array.from(document.querySelectorAll('.site-include'));
      const basePath = new URL('./', window.location.href);

      if (typeof fetch !== 'function') {
        siteIncludeContainers.forEach(container => {
          container.innerHTML = '<div class="load-error">Your browser does not support the required features to load this form.</div>';
        });
        return;
      }

      function loadSiteIncludes() {
        const loaders = siteIncludeContainers.map(container => {
          const src = container.dataset.src;
          if (!src) {
            return Promise.resolve();
          }
          const url = new URL(src, basePath);
          return fetch(url.href, { credentials: 'same-origin' })
            .then(response => {
              if (!response.ok) {
                throw new Error(`Failed to fetch ${url.href}: ${response.status}`);
              }
              return response.text();
            })
            .then(html => {
              container.innerHTML = html;
            })
            .catch(error => {
              console.error(error);
              container.innerHTML = '<div class="load-error">Unable to load this search form.</div>';
            });
        });

        if (Promise.allSettled) {
          return Promise.allSettled(loaders);
        }
        return Promise.all(loaders);
      }

      function activateForm(formId) {
        document.querySelectorAll('.search-form').forEach(form => form.classList.remove('active'));
        const target = document.getElementById(formId);
        if (target) {
          target.classList.add('active');
          return;
        }
        const fallback = document.querySelector('.search-form');
        if (fallback) {
          fallback.classList.add('active');
        }
      }

      providerSelects.forEach(select => {
        select.addEventListener('change', (event) => {
          const value = event.target.value;
          if (!value) {
            return;
          }
          providerSelects.forEach(other => {
            if (other !== event.target) {
              other.value = '';
            }
          });
          activateForm(value);
        });
      });

      loadSiteIncludes().then(() => {
        initializeForms();
        let defaultValue = 'google-web';
        const defaultSelect = document.getElementById('providerSelectGoogle');
        if (defaultSelect) {
          if (defaultSelect.value) {
            defaultValue = defaultSelect.value;
          } else {
            defaultSelect.value = defaultValue;
          }
        }
        activateForm(defaultValue);
      });
    });

    function formatDateForGoogle(value) {
      if (!value) return '';
      const parts = value.split('-');
      if (parts.length !== 3) return '';
      return `${parts[1]}/${parts[2]}/${parts[0]}`;
    }

    function resetGoogleWeb() {
      document.getElementById('google-web-tbs').value = '';
    }

    function resetGoogleImages() {
      document.getElementById('google-images-tbs').value = '';
    }

    function resetScholar() {
      document.getElementById('scholar-tbs').value = '';
    }

    function searchGoogleNews() {
      const topic = document.getElementById('news-topic').value;
      let baseUrl = 'https://news.google.com/search';
      if (topic) {
        baseUrl = `https://news.google.com/topics/${topic}`;
      }

      const queryParts = [];
      const allWords = document.getElementById('news-q-all').value.trim();
      if (allWords) queryParts.push(allWords);

      const exact = document.getElementById('news-q-exact').value.trim();
      if (exact) queryParts.push(`"${exact}"`);

      const anyWords = document.getElementById('news-q-any').value.trim();
      if (anyWords) {
        const any = anyWords.split(/\s+/).filter(Boolean).join(' OR ');
        if (any) queryParts.push(`(${any})`);
      }

      const noneWords = document.getElementById('news-q-none').value.trim();
      if (noneWords) {
        const none = noneWords.split(/\s+/).filter(Boolean).map(word => `-${word}`).join(' ');
        if (none) queryParts.push(none);
      }

      const intitle = document.getElementById('news-intitle').value.trim();
      if (intitle) queryParts.push(`intitle:${intitle}`);

      const inurl = document.getElementById('news-inurl').value.trim();
      if (inurl) queryParts.push(`inurl:${inurl}`);

      const site = document.getElementById('news-site').value.trim();
      if (site) queryParts.push(`site:${site}`);

      const location = document.getElementById('news-location').value.trim();
      if (location) queryParts.push(`location:"${location}"`);

      const params = new URLSearchParams();
      const queryString = queryParts.join(' ').trim();
      if (queryString) params.set('for', queryString);

      const tbsParts = [];
      const timeSort = document.getElementById('news-time-sort').value;
      if (timeSort) tbsParts.push(timeSort);

      const start = formatDateForGoogle(document.getElementById('news-date-start').value);
      const end = formatDateForGoogle(document.getElementById('news-date-end').value);
      if (start || end) {
        const cdrSegments = ['cdr:1'];
        if (start) cdrSegments.push(`cd_min:${start}`);
        if (end) cdrSegments.push(`cd_max:${end}`);
        tbsParts.push(cdrSegments.join(','));
      }

      if (document.getElementById('news-hide-duplicates').checked) {
        tbsParts.push('nsnd:1');
      }

      if (tbsParts.length) {
        params.set('tbs', tbsParts.join(','));
      }

      const edition = document.getElementById('news-edition').value;
      if (edition) {
        const [hlPreset, glPreset, ceidPreset] = edition.split('|');
        if (hlPreset) params.set('hl', hlPreset);
        if (glPreset) params.set('gl', glPreset);
        if (ceidPreset) params.set('ceid', ceidPreset);
      }

      const language = document.getElementById('news-language').value.trim();
      if (language) params.set('hl', language);

      const country = document.getElementById('news-country').value.trim();
      if (country) params.set('gl', country);

      const ceid = document.getElementById('news-ceid').value.trim();
      if (ceid) params.set('ceid', ceid);

      const num = document.getElementById('news-num').value;
      if (num) params.set('num', num);

      const safe = document.getElementById('news-safe').value;
      if (safe) params.set('safe', safe);

      if (!params.has('for') && !params.has('tbs') && !topic) {
        alert('Please enter search terms or choose a topic for Google News.');
        return;
      }

      const urlParams = params.toString();
      window.open(urlParams ? `${baseUrl}?${urlParams}` : baseUrl, '_blank');
    }
    function buildGitHubDateRange(afterValue, beforeValue, key) {
      const after = afterValue ? afterValue : '';
      const before = beforeValue ? beforeValue : '';
      if (after && before) return `${key}:${after}..${before}`;
      if (after) return `${key}:>${after}`;
      if (before) return `${key}:<${before}`;
      return '';
    }

    function searchGitHub() {
      const queryParts = [];
      const keywords = document.getElementById('github-q').value.trim();
      if (keywords) queryParts.push(keywords);

      const repo = document.getElementById('github-repo').value.trim();
      if (repo) queryParts.push(`repo:${repo}`);

      const user = document.getElementById('github-user').value.trim();
      if (user) queryParts.push(`user:${user}`);

      const org = document.getElementById('github-org').value.trim();
      if (org) queryParts.push(`org:${org}`);

      const topicsRaw = document.getElementById('github-topics').value;
      if (topicsRaw) {
        topicsRaw.split(/[,;]+/).map(topic => topic.trim()).filter(Boolean).forEach(topic => {
          queryParts.push(`topic:${topic}`);
        });
      }

      const language = document.getElementById('github-lang').value.trim();
      if (language) queryParts.push(`language:${language}`);

      const license = document.getElementById('github-license').value.trim();
      if (license) queryParts.push(`license:${license}`);

      const stars = document.getElementById('github-stars').value.trim();
      if (stars) queryParts.push(`stars:${stars}`);

      const forks = document.getElementById('github-forks').value.trim();
      if (forks) queryParts.push(`forks:${forks}`);

      const forkOption = document.getElementById('github-fork-option').value;
      if (forkOption) queryParts.push(`fork:${forkOption}`);

      const size = document.getElementById('github-size').value.trim();
      if (size) queryParts.push(`size:${size}`);

      const goodFirst = document.getElementById('github-good-first').value.trim();
      if (goodFirst) queryParts.push(`good-first-issues:${goodFirst}`);

      const helpWanted = document.getElementById('github-help-wanted').value.trim();
      if (helpWanted) queryParts.push(`help-wanted-issues:${helpWanted}`);

      const followers = document.getElementById('github-followers').value.trim();
      if (followers) queryParts.push(`followers:${followers}`);

      const label = document.getElementById('github-label').value.trim();
      if (label) queryParts.push(`label:${label}`);

      const issueState = document.getElementById('github-issue-state').value;
      if (issueState === 'open' || issueState === 'closed') {
        queryParts.push(`state:${issueState}`);
      } else if (issueState === 'merged') {
        queryParts.push('is:pr');
        queryParts.push('is:merged');
      } else if (issueState === 'draft') {
        queryParts.push('draft:true');
      }

      const archived = document.getElementById('github-archived').value;
      if (archived) queryParts.push(`archived:${archived}`);

      const pushedQualifier = buildGitHubDateRange(
        document.getElementById('github-pushed-after').value,
        document.getElementById('github-pushed-before').value,
        'pushed'
      );
      if (pushedQualifier) queryParts.push(pushedQualifier);

      const createdQualifier = buildGitHubDateRange(
        document.getElementById('github-created-after').value,
        document.getElementById('github-created-before').value,
        'created'
      );
      if (createdQualifier) queryParts.push(createdQualifier);

      const scope = document.getElementById('github-scope').value;
      const enforcedScopeQualifiers = [];
      let typeParam = 'repositories';

      switch (scope) {
        case 'code':
          typeParam = 'code';
          break;
        case 'issues':
          typeParam = 'issues';
          break;
        case 'prs':
          typeParam = 'issues';
          enforcedScopeQualifiers.push('type:pr');
          break;
        case 'discussions':
          typeParam = 'discussions';
          enforcedScopeQualifiers.push('type:discussion');
          break;
        case 'wikis':
          typeParam = 'wikis';
          enforcedScopeQualifiers.push('type:wiki');
          break;
        case 'users':
          typeParam = 'users';
          enforcedScopeQualifiers.push('type:user');
          break;
        default:
          typeParam = 'repositories';
      }

      enforcedScopeQualifiers.forEach(q => queryParts.push(q));

      const finalQuery = queryParts.join(' ').trim();
      if (!finalQuery) {
        alert('Please enter keywords or qualifiers for the GitHub search.');
        return;
      }

      const params = new URLSearchParams();
      params.set('q', finalQuery);
      params.set('type', typeParam);

      const sortSelection = document.getElementById('github-sort').value;
      if (sortSelection) {
        const [sortKey, sortOrder] = sortSelection.split('-');
        params.set('s', sortKey);
        params.set('o', sortOrder);
      }

      window.open(`https://github.com/search?${params.toString()}`, '_blank');
    }

    function searchReddit() {
      const params = new URLSearchParams();
      const queryParts = [];
      const keywords = document.getElementById('reddit-q').value.trim();
      if (keywords) queryParts.push(keywords);

      const subreddit = document.getElementById('reddit-sub').value.trim();
      if (subreddit) queryParts.push(`subreddit:${subreddit}`);

      const author = document.getElementById('reddit-author').value.trim();
      if (author) queryParts.push(`author:${author}`);

      const flair = document.getElementById('reddit-flair').value.trim();
      if (flair) queryParts.push(`flair:"${flair}"`);

      const title = document.getElementById('reddit-title').value.trim();
      if (title) queryParts.push(`title:"${title}"`);

      const selftext = document.getElementById('reddit-selftext').value.trim();
      if (selftext) queryParts.push(`selftext:${selftext}`);

      const site = document.getElementById('reddit-site').value.trim();
      if (site) queryParts.push(`site:${site}`);

      const selfToggle = document.getElementById('reddit-self').value;
      if (selfToggle) queryParts.push(`self:${selfToggle}`);

      const nsfw = document.getElementById('reddit-nsfw').value;
      if (nsfw) queryParts.push(`nsfw:${nsfw}`);

      const queryString = queryParts.join(' ').trim();
      if (!queryString) {
        alert('Please enter keywords or filters for Reddit search.');
        return;
      }

      params.set('q', queryString);

      const resultType = document.getElementById('reddit-type').value;
      if (resultType) params.set('type', resultType);

      params.set('sort', document.getElementById('reddit-sort').value);
      params.set('t', document.getElementById('reddit-time').value);

      const limit = document.getElementById('reddit-limit').value;
      if (limit) params.set('limit', limit);

      if (document.getElementById('reddit-include-over-18').checked) {
        params.set('include_over_18', 'true');
      }

      const restrictValue = document.getElementById('reddit-restrict').value;
      if (restrictValue) {
        params.set('restrict_sr', restrictValue);
      } else if (subreddit) {
        params.set('restrict_sr', '1');
      }

      let baseUrl = 'https://www.reddit.com/search';
      if (subreddit) {
        baseUrl = `https://www.reddit.com/r/${subreddit}/search`;
      }

      window.open(`${baseUrl}?${params.toString()}`, '_blank');
    }

    function searchYouTube() {
      let query = document.getElementById('yt-q').value.trim();
      const channel = document.getElementById('yt-channel').value.trim();
      if (channel) query += ` channel:${channel}`;
      const title = document.getElementById('yt-title').value.trim();
      if (title) query += ` intitle:${title}`;

      const duration = document.getElementById('yt-duration').value;
      if (duration) query += ` ${duration}`;

      const playlistFilter = document.getElementById('yt-playlist').value;
      if (playlistFilter) query += ` ${playlistFilter}`;

      const after = document.getElementById('yt-after').value;
      if (after) query += ` after:${after}`;

      const before = document.getElementById('yt-before').value;
      if (before) query += ` before:${before}`;

      if (document.getElementById('yt-hd').checked) query += ' hd';
      if (document.getElementById('yt-4k').checked) query += ' 4k';
      if (document.getElementById('yt-subtitles').checked) query += ' subtitles';
      if (document.getElementById('yt-cc').checked) query += ' creativecommons';
      if (document.getElementById('yt-live').checked) query += ' live';
      if (document.getElementById('yt-3d').checked) query += ' 3d';
      if (document.getElementById('yt-360').checked) query += ' 360';
      if (document.getElementById('yt-hdr').checked) query += ' hdr';

      query = query.trim();
      if (!query) {
        alert('Please enter search keywords for YouTube.');
        return;
      }

      const params = new URLSearchParams();
      params.set('search_query', query);

      window.open(`https://www.youtube.com/results?${params.toString()}`, '_blank');
    }

    function searchStackOverflow() {
      let query = document.getElementById('so-q').value.trim();

      const tags = document.getElementById('so-tags').value;
      if (tags) {
        tags.split(/[,\s]+/).filter(Boolean).forEach(tag => {
          query += ` [${tag.trim()}]`;
        });
      }

      const excludeTags = document.getElementById('so-exclude-tags').value;
      if (excludeTags) {
        excludeTags.split(/[,\s]+/).filter(Boolean).forEach(tag => {
          query += ` -[${tag.trim()}]`;
        });
      }

      const user = document.getElementById('so-user').value.trim();
      if (user) query += ` user:${user}`;

      const score = document.getElementById('so-score').value.trim();
      if (score) query += ` score:${score}`;

      const views = document.getElementById('so-views').value.trim();
      if (views) query += ` views:${views}`;

      const answers = document.getElementById('so-answers').value.trim();
      if (answers) query += ` answers:${answers}`;

      const createdAfter = document.getElementById('so-created-after').value;
      const createdBefore = document.getElementById('so-created-before').value;
      if (createdAfter && createdBefore) {
        query += ` created:${createdAfter}..${createdBefore}`;
      } else if (createdAfter) {
        query += ` created:>${createdAfter}`;
      } else if (createdBefore) {
        query += ` created:<${createdBefore}`;
      }

      if (document.getElementById('so-is-question').checked) query += ' is:question';
      if (document.getElementById('so-is-answer').checked) query += ' is:answer';
      if (document.getElementById('so-is-article').checked) query += ' is:article';
      if (document.getElementById('so-hasaccepted').checked) query += ' hasaccepted:yes';
      if (document.getElementById('so-isaccepted').checked) query += ' isaccepted:yes';
      if (document.getElementById('so-duplicate').checked) query += ' duplicate:yes';
      if (document.getElementById('so-closed').checked) query += ' closed:yes';
      if (document.getElementById('so-wiki').checked) query += ' wiki:yes';
      if (document.getElementById('so-hascode').checked) query += ' hascode:yes';

      query = query.trim();
      if (!query) {
        alert('Please enter keywords or qualifiers for Stack Overflow.');
        return;
      }

      window.open(`https://stackoverflow.com/search?q=${encodeURIComponent(query)}`, '_blank');
    }


    function tokenizeList(value) {
      if (!value) return [];
      return value.split(/(?:\r?\n|[,;])+/).map(part => part.trim()).filter(Boolean);
    }

    function wrapForQuery(term) {
      if (!term) return '';
      return /\s/.test(term) ? `"${term}"` : term;
    }

    function appendColonFilters(parts, values, operator) {
      values.forEach(value => parts.push(`${operator}:${wrapForQuery(value)}`));
    }

    function buildRangeQuery(minValue, maxValue, keyword) {
      const min = minValue ? parseInt(minValue, 10) : NaN;
      const max = maxValue ? parseInt(maxValue, 10) : NaN;

      if (!Number.isNaN(min) && !Number.isNaN(max)) {
        const low = Math.min(min, max);
        const high = Math.max(min, max);
        return `${keyword}:${low},${high}`;
      }

      if (!Number.isNaN(min)) {
        return `${keyword}:>${min}`;
      }

      if (!Number.isNaN(max)) {
        return `${keyword}:<${max}`;
      }

      return '';
    }

    function searchWikipedia() {
      const queryParts = [];
      const allWords = document.getElementById('wikipedia-all').value.trim();
      if (allWords) queryParts.push(allWords);

      const exactPhrase = document.getElementById('wikipedia-exact').value.trim();
      if (exactPhrase) queryParts.push(`"${exactPhrase}"`);

      const anyWords = document.getElementById('wikipedia-any').value.trim();
      if (anyWords) {
        const tokens = anyWords.split(/\s+/).filter(Boolean);
        if (tokens.length) {
          queryParts.push(`(${tokens.join(' OR ')})`);
        }
      }

      const noneWords = document.getElementById('wikipedia-none').value.trim();
      if (noneWords) {
        noneWords.split(/\s+/).filter(Boolean).forEach(word => {
          const wrapped = /\s/.test(word) ? `"${word}"` : word;
          queryParts.push(`-${wrapped}`);
        });
      }

      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikipedia-intitle').value), 'intitle');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikipedia-insource').value), 'insource');

      const regexPattern = document.getElementById('wikipedia-insource-regex').value.trim();
      if (regexPattern) {
        queryParts.push(`insource:/${regexPattern}/`);
      }

      const prefix = document.getElementById('wikipedia-prefix').value.trim();
      if (prefix) {
        queryParts.push(`prefix:${prefix.replace(/\s+/g, '_')}`);
      }

      const morelike = document.getElementById('wikipedia-morelike').value.trim();
      if (morelike) {
        queryParts.push(`morelike:${wrapForQuery(morelike)}`);
      }

      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikipedia-incategory').value), 'incategory');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikipedia-deepcat').value), 'deepcat');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikipedia-hastemplate').value), 'hastemplate');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikipedia-linksto').value), 'linksto');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikipedia-linkfrom').value), 'linkfrom');

      const filetypes = tokenizeList(document.getElementById('wikipedia-filetype').value);
      filetypes.forEach(value => queryParts.push(`filetype:${value.toLowerCase()}`));

      const query = queryParts.join(' ').trim();
      if (!query) {
        alert('Please enter keywords or filters for the Wikipedia search.');
        return;
      }

      const params = new URLSearchParams();
      params.set('title', 'Special:Search');
      params.set('profile', 'advanced');
      params.set('fulltext', '1');
      params.set('search', query);

      const namespaceBoxes = Array.from(document.querySelectorAll('#wikipedia input[name="wikipedia-namespace"]:checked'));
      if (namespaceBoxes.length) {
        namespaceBoxes.forEach(box => params.set(`ns${box.value}`, '1'));
      } else {
        params.set('ns0', '1');
      }

      const sort = document.getElementById('wikipedia-sort').value;
      if (sort) {
        params.set('sort', sort);
      }

      const limit = document.getElementById('wikipedia-limit').value;
      if (limit) {
        params.set('limit', limit);
      }

      window.open(`https://en.wikipedia.org/w/index.php?${params.toString()}`, '_blank');
    }




    function searchWikibooks() {
      const queryParts = [];
      const allWords = document.getElementById('wikibooks-all').value.trim();
      if (allWords) queryParts.push(allWords);

      const exactPhrase = document.getElementById('wikibooks-exact').value.trim();
      if (exactPhrase) queryParts.push(`"${exactPhrase}"`);

      const anyWords = document.getElementById('wikibooks-any').value.trim();
      if (anyWords) {
        const tokens = anyWords.split(/\s+/).filter(Boolean);
        if (tokens.length) {
          queryParts.push(`(${tokens.join(' OR ')})`);
        }
      }

      const noneWords = document.getElementById('wikibooks-none').value.trim();
      if (noneWords) {
        noneWords.split(/\s+/).filter(Boolean).forEach(word => {
          const wrapped = /\s/.test(word) ? `"${word}"` : word;
          queryParts.push(`-${wrapped}`);
        });
      }

      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikibooks-intitle').value), 'intitle');

      const subpage = document.getElementById('wikibooks-subpageof').value.trim();
      if (subpage) {
        const normalized = subpage.replace(/\s+/g, '_');
        queryParts.push(`subpageof:${normalized}`);
      }

      const prefixValue = document.getElementById('wikibooks-prefix').value.trim();
      if (prefixValue) {
        queryParts.push(`prefix:${prefixValue.replace(/\s+/g, '_')}`);
      }

      const morelike = document.getElementById('wikibooks-morelike').value.trim();
      if (morelike) {
        queryParts.push(`morelike:${wrapForQuery(morelike)}`);
      }

      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikibooks-incategory').value), 'incategory');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikibooks-deepcat').value), 'deepcat');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikibooks-hastemplate').value), 'hastemplate');

      const query = queryParts.join(' ').trim();
      if (!query) {
        alert('Please enter keywords or filters for the Wikibooks search.');
        return;
      }

      const params = new URLSearchParams();
      params.set('title', 'Special:Search');
      params.set('profile', 'advanced');
      params.set('fulltext', '1');
      params.set('search', query);

      const namespaceBoxes = Array.from(document.querySelectorAll('#wikibooks input[name="wikibooks-namespace"]:checked'));
      if (namespaceBoxes.length) {
        namespaceBoxes.forEach(box => params.set(`ns${box.value}`, '1'));
      } else {
        ['0', '102', '110', '112'].forEach(ns => params.set(`ns${ns}`, '1'));
      }

      window.open(`https://en.wikibooks.org/w/index.php?${params.toString()}`, '_blank');
    }

    function searchWikisource() {
      const queryParts = [];
      const allWords = document.getElementById('wikisource-all').value.trim();
      if (allWords) queryParts.push(allWords);

      const exactPhrase = document.getElementById('wikisource-exact').value.trim();
      if (exactPhrase) queryParts.push(`"${exactPhrase}"`);

      const anyWords = document.getElementById('wikisource-any').value.trim();
      if (anyWords) {
        const tokens = anyWords.split(/\s+/).filter(Boolean);
        if (tokens.length) {
          queryParts.push(`(${tokens.join(' OR ')})`);
        }
      }

      const noneWords = document.getElementById('wikisource-none').value.trim();
      if (noneWords) {
        noneWords.split(/\s+/).filter(Boolean).forEach(word => {
          const wrapped = /\s/.test(word) ? `"${word}"` : word;
          queryParts.push(`-${wrapped}`);
        });
      }

      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikisource-author').value), 'author');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikisource-intitle').value), 'intitle');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('wikisource-all-namespaces').value), 'all');

      const prefix = document.getElementById('wikisource-prefix').value.trim();
      if (prefix) {
        queryParts.push(`prefix:${prefix.replace(/[\s]+/g, '_')}`);
      }

      const query = queryParts.join(' ').trim();
      if (!query) {
        alert('Please enter keywords or filters for the Wikisource search.');
        return;
      }

      const params = new URLSearchParams();
      params.set('title', 'Special:Search');
      params.set('profile', 'advanced');
      params.set('fulltext', '1');
      params.set('search', query);

      const namespaceBoxes = Array.from(document.querySelectorAll('#wikisource input[name="wikisource-namespace"]:checked'));
      if (namespaceBoxes.length) {
        namespaceBoxes.forEach(box => params.set(`ns${box.value}`, '1'));
      } else {
        ['0', '102', '100'].forEach(ns => params.set(`ns${ns}`, '1'));
      }

      window.open(`https://en.wikisource.org/w/index.php?${params.toString()}`, '_blank');
    }

    function searchCommons() {
      const queryParts = [];
      const allWords = document.getElementById('commons-all').value.trim();
      if (allWords) queryParts.push(allWords);

      const exactPhrase = document.getElementById('commons-exact').value.trim();
      if (exactPhrase) queryParts.push(`"${exactPhrase}"`);

      const anyWords = document.getElementById('commons-any').value.trim();
      if (anyWords) {
        const tokens = anyWords.split(/[\s]+/).filter(Boolean);
        if (tokens.length) {
          queryParts.push(`(${tokens.join(' OR ')})`);
        }
      }

      const noneWords = document.getElementById('commons-none').value.trim();
      if (noneWords) {
        noneWords.split(/[\s]+/).filter(Boolean).forEach(word => {
          const wrapped = /\s/.test(word) ? `"${word}"` : word;
          queryParts.push(`-${wrapped}`);
        });
      }

      appendColonFilters(queryParts, tokenizeList(document.getElementById('commons-intitle').value), 'intitle');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('commons-insource').value), 'insource');

      const prefix = document.getElementById('commons-prefix').value.trim();
      if (prefix) {
        queryParts.push(`prefix:${prefix.replace(/[\s]+/g, '_')}`);
      }

      appendColonFilters(queryParts, tokenizeList(document.getElementById('commons-incategory').value), 'incategory');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('commons-deepcat').value), 'deepcat');
      appendColonFilters(queryParts, tokenizeList(document.getElementById('commons-hastemplate').value), 'hastemplate');

      const fileType = document.getElementById('commons-filetype').value;
      if (fileType) queryParts.push(`filetype:${fileType}`);

      const mime = document.getElementById('commons-mime').value.trim();
      if (mime) {
        const needsQuotes = /[^\w.+\-\/]/.test(mime);
        queryParts.push(`filemime:${needsQuotes ? `"${mime}"` : mime}`);
      }

      const widthFilter = buildRangeQuery(document.getElementById('commons-width-min').value.trim(), document.getElementById('commons-width-max').value.trim(), 'filew');
      if (widthFilter) queryParts.push(widthFilter);

      const heightFilter = buildRangeQuery(document.getElementById('commons-height-min').value.trim(), document.getElementById('commons-height-max').value.trim(), 'fileh');
      if (heightFilter) queryParts.push(heightFilter);

      const sizeFilter = buildRangeQuery(document.getElementById('commons-size-min').value.trim(), document.getElementById('commons-size-max').value.trim(), 'filesize');
      if (sizeFilter) queryParts.push(sizeFilter);

      const bitsValue = document.getElementById('commons-bits').value.trim();
      if (bitsValue) {
        const parsedBits = parseInt(bitsValue, 10);
        if (!Number.isNaN(parsedBits)) {
          queryParts.push(`filebits:${parsedBits}`);
        }
      }

      const query = queryParts.join(' ').trim();
      if (!query) {
        alert('Please enter keywords or filters for the Wikimedia Commons search.');
        return;
      }

      const params = new URLSearchParams();
      params.set('title', 'Special:Search');
      params.set('profile', 'advanced');
      params.set('fulltext', '1');
      params.set('search', query);

      const namespaceBoxes = Array.from(document.querySelectorAll('#wikimedia-commons input[name="commons-namespace"]:checked'));
      if (namespaceBoxes.length) {
        namespaceBoxes.forEach(box => params.set(`ns${box.value}`, '1'));
      } else {
        params.set('ns6', '1');
      }

      const sort = document.getElementById('commons-sort').value;
      if (sort) {
        params.set('sort', sort);
      }

      const limit = document.getElementById('commons-limit').value;
      if (limit) {
        params.set('limit', limit);
      }

      window.open(`https://commons.wikimedia.org/w/index.php?${params.toString()}`, '_blank');
    }

    function searchMDN() {
      const format = document.querySelector('input[name="mdn-format"]:checked')?.value || 'html';
      const localeValue = document.getElementById('mdn-locale').value.trim();
      const query = document.getElementById('mdn-q').value.trim();

      let hasCriteria = Boolean(query);
      const params = new URLSearchParams();

      const topics = tokenizeList(document.getElementById('mdn-topics').value);
      if (topics.length) {
        params.set('topic', topics.join(','));
        hasCriteria = true;
      }

      const skillValues = Array.from(document.querySelectorAll('input[name="mdn-skill"]:checked')).map(node => node.value);
      if (skillValues.length) {
        params.set('skill', skillValues.join(','));
        hasCriteria = true;
      }

      const typeValues = Array.from(document.querySelectorAll('input[name="mdn-type"]:checked')).map(node => node.value);
      if (typeValues.length) {
        params.set('document_type', typeValues.join(','));
        hasCriteria = true;
      }

      const cssClasses = tokenizeList(document.getElementById('mdn-css-classes').value);
      if (cssClasses.length) {
        params.set('css_classnames', cssClasses.join(','));
        hasCriteria = true;
      }

      const htmlAttributes = document.getElementById('mdn-html-attributes').value.trim();
      if (htmlAttributes) {
        params.set('html_attributes', htmlAttributes);
        hasCriteria = true;
      }

      const macros = tokenizeList(document.getElementById('mdn-kumascript').value);
      if (macros.length) {
        params.set('kumascript_macros', macros.join(','));
        hasCriteria = true;
      }

      const page = document.getElementById('mdn-page').value.trim();
      if (page) {
        params.set('page', page);
      }

      const highlight = document.getElementById('mdn-highlight').value;
      if (highlight && highlight !== 'true') {
        params.set('highlight', highlight);
      }

      if (!hasCriteria) {
        alert('Please provide a query or at least one filter for the MDN search.');
        return;
      }

      params.set('q', query);

      let baseUrl = '';
      if (format === 'html') {
        const localeSegment = localeValue && localeValue !== '*' ? localeValue : 'en-US';
        baseUrl = `https://developer.mozilla.org/${localeSegment}/search`;
        if (localeValue && (localeValue === '*' || localeValue !== localeSegment)) {
          params.set('locale', localeValue);
        }
      } else {
        baseUrl = 'https://developer.mozilla.org/api/v1/search';
        if (localeValue) {
          params.set('locale', localeValue);
        }
      }

      const queryString = params.toString();
      const targetUrl = queryString ? `${baseUrl}?${queryString}` : baseUrl;
      window.open(targetUrl, '_blank');
    }

    function searchIMDb() {
      const params = new URLSearchParams();
      const title = document.getElementById('imdb-title').value.trim();
      if (title) params.set('title', title);

      const plot = document.getElementById('imdb-plot').value.trim();
      if (plot) params.set('plot', plot);

      const includeKeywords = tokenizeList(document.getElementById('imdb-keywords').value);
      const excludeKeywords = tokenizeList(document.getElementById('imdb-keywords-exclude').value);
      if (includeKeywords.length || excludeKeywords.length) {
        const keywordParts = includeKeywords.slice();
        excludeKeywords.forEach(keyword => {
          if (keyword) {
            const cleaned = keyword.replace(/^!+/, '');
            keywordParts.push(`!${cleaned}`);
          }
        });
        if (keywordParts.length) {
          params.set('keywords', keywordParts.join(','));
        }
      }

      const titleTypes = Array.from(document.querySelectorAll('input[name="imdb-title-type"]:checked'));
      if (titleTypes.length) {
        params.set('title_type', titleTypes.map(node => node.value).join(','));
      }

      const genres = Array.from(document.querySelectorAll('input[name="imdb-genre"]:checked'));
      if (genres.length) {
        params.set('genres', genres.map(node => node.value).join(','));
      }

      const releaseStart = document.getElementById('imdb-release-start').value;
      const releaseEnd = document.getElementById('imdb-release-end').value;
      if (releaseStart || releaseEnd) {
        params.set('release_date', `${releaseStart || ''},${releaseEnd || ''}`);
      }

      const ratingMin = document.getElementById('imdb-rating-min').value.trim();
      const ratingMax = document.getElementById('imdb-rating-max').value.trim();
      if (ratingMin || ratingMax) {
        params.set('user_rating', `${ratingMin || ''},${ratingMax || ''}`);
      }

      const votesMin = document.getElementById('imdb-votes-min').value.trim();
      const votesMax = document.getElementById('imdb-votes-max').value.trim();
      if (votesMin || votesMax) {
        params.set('num_votes', `${votesMin || ''},${votesMax || ''}`);
      }

      const runtimeMin = document.getElementById('imdb-runtime-min').value.trim();
      const runtimeMax = document.getElementById('imdb-runtime-max').value.trim();
      if (runtimeMin || runtimeMax) {
        params.set('runtime', `${runtimeMin || ''},${runtimeMax || ''}`);
      }

      const countries = tokenizeList(document.getElementById('imdb-countries').value);
      if (countries.length) {
        params.set('countries', countries.join(','));
      }

      const languages = tokenizeList(document.getElementById('imdb-languages').value);
      if (languages.length) {
        params.set('languages', languages.join(','));
      }

      const adultSelection = document.querySelector('input[name="imdb-adult"]:checked');
      if (adultSelection && adultSelection.value === 'include') {
        params.set('adult', 'include');
      }

      const sort = document.getElementById('imdb-sort').value;
      if (sort) params.set('sort', sort);

      const count = document.getElementById('imdb-count').value;
      if (count) params.set('count', count);

      const page = document.getElementById('imdb-page').value.trim();
      if (page) params.set('page', page);

      const targetUrl = `https://www.imdb.com/search/title/?${params.toString()}`;
      window.open(targetUrl, '_blank');
    }

    function searchPyPI() {
      const params = new URLSearchParams();
      const query = document.getElementById('pypi-q').value.trim();
      params.set('q', query || '');

      const classifiers = tokenizeList(document.getElementById('pypi-classifiers').value);
      classifiers.forEach(value => params.append('c', value));

      const pythonVersion = document.getElementById('pypi-python-version').value.trim();
      if (pythonVersion) params.set('o', pythonVersion);

      const implementation = document.getElementById('pypi-implementation').value.trim();
      if (implementation) params.set('i', implementation);

      const status = document.getElementById('pypi-status').value.trim();
      if (status) params.set('ps', status);

      const appendList = (inputId, key) => {
        tokenizeList(document.getElementById(inputId).value).forEach(value => params.append(key, value));
      };

      appendList('pypi-audience', 'pf');
      appendList('pypi-topic', 'topic');
      appendList('pypi-framework', 'f');
      appendList('pypi-license', 'l');
      appendList('pypi-language', 'pl');
      appendList('pypi-os', 'os');
      appendList('pypi-environment', 'e');
      appendList('pypi-natural-language', 'nl');

      const sort = document.getElementById('pypi-sort').value;
      if (sort) params.set('sort', sort);

      window.open(`https://pypi.org/search/?${params.toString()}`, '_blank');
    }


    function searchPubMed() {
      const params = new URLSearchParams();
      const queryParts = [];

      const keywords = document.getElementById('pubmed-keywords').value.trim();
      if (keywords) queryParts.push(keywords);

      const phrase = document.getElementById('pubmed-phrase').value.trim();
      if (phrase) queryParts.push(`"${phrase}"`);

      const anyWords = document.getElementById('pubmed-any').value.trim();
      if (anyWords) {
        const tokens = anyWords.split(/\s+/).filter(Boolean);
        if (tokens.length) {
          queryParts.push(`(${tokens.join(' OR ')})`);
        }
      }

      const excludeWords = document.getElementById('pubmed-exclude').value.trim();
      if (excludeWords) {
        excludeWords.split(/\s+/).filter(Boolean).forEach(word => {
          queryParts.push(`NOT ${word}`);
        });
      }

      const authors = tokenizeList(document.getElementById('pubmed-authors').value);
      if (authors.length) {
        const authorParts = authors.map(name => `${wrapForQuery(name)}[au]`);
        queryParts.push(`(${authorParts.join(' OR ')})`);
      }

      const titleWords = tokenizeList(document.getElementById('pubmed-title').value);
      if (titleWords.length) {
        const titleParts = titleWords.map(word => `${wrapForQuery(word)}[ti]`);
        queryParts.push(`(${titleParts.join(' AND ')})`);
      }

      const journal = document.getElementById('pubmed-journal').value.trim();
      if (journal) {
        queryParts.push(`${wrapForQuery(journal)}[jour]`);
      }

      const pmids = tokenizeList(document.getElementById('pubmed-pmids').value);
      if (pmids.length) {
        const pmidParts = pmids.map(id => `${id}[pmid]`);
        queryParts.push(`(${pmidParts.join(' OR ')})`);
      }

      if (!queryParts.length) {
        alert('Please enter keywords or field terms for the PubMed search.');
        return;
      }

      const term = queryParts.join(' AND ').trim();
      params.set('term', term);

      const articleTypes = Array.from(document.querySelectorAll('input[name="pubmed-pubtype"]:checked')).map(node => node.value);
      articleTypes.forEach(code => params.append('filter', code));

      const textAvailability = document.querySelector('input[name="pubmed-text"]:checked')?.value || '';
      if (textAvailability) {
        params.append('filter', textAvailability);
      }

      const preset = document.getElementById('pubmed-date-preset').value;
      const yearFrom = document.getElementById('pubmed-year-from').value.trim();
      const yearTo = document.getElementById('pubmed-year-to').value.trim();
      const hasCustomRange = Boolean(yearFrom || yearTo);

      if (hasCustomRange) {
        params.append('filter', 'dates');
        if (yearFrom) {
          params.set('mindate', `${yearFrom}/01/01`);
        }
        if (yearTo) {
          params.set('maxdate', `${yearTo}/12/31`);
        }
      } else if (preset) {
        params.append('filter', preset);
      }

      const size = document.getElementById('pubmed-size').value;
      if (size) params.set('size', size);

      const sort = document.getElementById('pubmed-sort').value;
      if (sort) params.set('sort', sort);

      const page = document.getElementById('pubmed-page').value.trim();
      if (page) params.set('page', page);

      const format = document.getElementById('pubmed-format').value;
      if (format) params.set('format', format);

      const targetUrl = `https://pubmed.ncbi.nlm.nih.gov/?${params.toString()}`;
      window.open(targetUrl, '_blank');
    }


    function initializeForms() {
      const googleWebForm = document.getElementById('google-web');
      if (googleWebForm) {
        googleWebForm.addEventListener('submit', () => {
          const tbsParts = [];
          const reading = document.getElementById('google-web-reading').value;
          if (reading) {
            tbsParts.push(reading);
          }
          const start = formatDateForGoogle(document.getElementById('google-web-date-start').value);
          const end = formatDateForGoogle(document.getElementById('google-web-date-end').value);
          if (start || end) {
            const cdrSegments = ['cdr:1'];
            if (start) cdrSegments.push(`cd_min:${start}`);
            if (end) cdrSegments.push(`cd_max:${end}`);
            tbsParts.push(cdrSegments.join(','));
          }
          if (document.getElementById('google-web-verbatim').checked) {
            tbsParts.push('li:1');
          }
          document.getElementById('google-web-tbs').value = tbsParts.join(',');
        });
      }

      const googleImagesForm = document.getElementById('google-images');
      if (googleImagesForm) {
        googleImagesForm.addEventListener('submit', () => {
          const tbsParts = [];
          const license = document.getElementById('google-images-license').value;
          if (license) tbsParts.push(license);
          const fileType = document.getElementById('google-images-filetype').value;
          if (fileType) tbsParts.push(fileType);
          const time = document.getElementById('google-images-time').value;
          if (time) tbsParts.push(time);
          const start = formatDateForGoogle(document.getElementById('google-images-date-start').value);
          const end = formatDateForGoogle(document.getElementById('google-images-date-end').value);
          if (start || end) {
            const cdrSegments = ['cdr:1'];
            if (start) cdrSegments.push(`cd_min:${start}`);
            if (end) cdrSegments.push(`cd_max:${end}`);
            tbsParts.push(cdrSegments.join(','));
          }
          document.getElementById('google-images-tbs').value = tbsParts.join(',');
        });
      }

      const scholarForm = document.getElementById('google-scholar');
      if (scholarForm) {
        scholarForm.addEventListener('submit', () => {
          const tbsParts = [];
          const start = formatDateForGoogle(document.getElementById('scholar-date-start').value);
          const end = formatDateForGoogle(document.getElementById('scholar-date-end').value);
          if (start || end) {
            const cdrSegments = ['cdr:1'];
            if (start) cdrSegments.push(`cd_min:${start}`);
            if (end) cdrSegments.push(`cd_max:${end}`);
            tbsParts.push(cdrSegments.join(','));
          }
          document.getElementById('scholar-tbs').value = tbsParts.join(',');
        });
      }
    }

    function searchArchive() {
      const queryParts = [];
      const keywords = document.getElementById('archive-q').value.trim();
      if (keywords) queryParts.push(`(${keywords})`);

      const collectionInput = document.getElementById('archive-collection').value.trim();
      if (collectionInput) {
        const collectionVariants = new Set();
        collectionVariants.add(collectionInput);
        const collapsed = collectionInput.replace(/\s+/g, '');
        if (collapsed && collapsed !== collectionInput) collectionVariants.add(collapsed);
        const underscored = collectionInput.replace(/\s+/g, '_');
        if (underscored && underscored !== collectionInput && underscored !== collapsed) collectionVariants.add(underscored);
        const clauses = Array.from(collectionVariants)
          .filter(Boolean)
          .map(value => `collection:${wrapForQuery(value)}`);
        if (clauses.length) {
          queryParts.push(clauses.length > 1 ? `(${clauses.join(' OR ')})` : clauses[0]);
        }
      }

      const mediatype = document.getElementById('archive-mediatype').value;
      if (mediatype) queryParts.push(`mediatype:${mediatype}`);

      const creator = document.getElementById('archive-creator').value.trim();
      if (creator) queryParts.push(`creator:"${creator}"`);

      const yearFrom = document.getElementById('archive-year-from').value;
      const yearTo = document.getElementById('archive-year-to').value;
      if (yearFrom && yearTo) {
        queryParts.push(`year:[${yearFrom} TO ${yearTo}]`);
      } else if (yearFrom) {
        queryParts.push(`year:[${yearFrom} TO *]`);
      } else if (yearTo) {
        queryParts.push(`year:[* TO ${yearTo}]`);
      }

      const license = document.getElementById('archive-license').value;
      if (license) queryParts.push(license);

      if (!queryParts.length) {
        alert('Please enter keywords or filters for the Internet Archive search.');
        return;
      }

      const queryString = queryParts.join(' AND ');

      const fieldsValue = document.getElementById('archive-fields').value;
      const fields = fieldsValue
        ? fieldsValue.split(/[,;]+/).map(field => field.trim()).filter(Boolean)
        : [];

      const sortValue = document.getElementById('archive-sort').value;
      const rows = document.getElementById('archive-rows').value.trim();
      const page = document.getElementById('archive-page').value.trim();
      const outputFormat = document.getElementById('archive-output').value || 'json';
      const totalOnly = document.getElementById('archive-total-only').checked;

      if (outputFormat === 'html') {
        const htmlParams = new URLSearchParams();
        htmlParams.set('query', queryString);
        if (sortValue) htmlParams.set('sort', sortValue.replace(/\s+/g, '+'));
        if (rows) htmlParams.set('rows', rows);
        if (page) htmlParams.set('page', page);
        window.open(`https://archive.org/search.php?${htmlParams.toString()}`, '_blank');
        return;
      }

      const params = new URLSearchParams();
      params.set('q', queryString);
      fields.forEach(field => params.append('fl[]', field));
      if (sortValue) params.append('sort[]', sortValue);
      if (rows) params.set('rows', rows);
      if (page) params.set('page', page);
      params.set('output', outputFormat);
      if (totalOnly) params.set('total_only', 'true');

      window.open(`https://archive.org/advancedsearch.php?${params.toString()}`, '_blank');
    }
  </script>
</body>
</html>
